<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homestay Details - KK Homestay</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
<h1>Homestay Details</h1>
<nav><a href="homestays.html">Back to List</a></nav>
</header>

<section>
<h2 id="homestay-name"></h2>
<div id="image-gallery"></div>
<p><strong>Location:</strong> <span id="homestay-location"></span></p>
<p><strong>Price:</strong> RM <span id="homestay-price"></span>/night</p>
<p id="homestay-description"></p>

<h3>Book This Homestay</h3>
<form id="booking-form">
  <label>Select Date</label>
  <input type="date" id="booking-date" required>
  <button type="submit">Proceed to Payment</button>
</form>
<p id="status"></p>
</section>

<script>
const API_BASE="https://kk-homestay-backend.onrender.com";
const params=new URLSearchParams(window.location.search);
const homestayId=params.get("homestay_id");
let userId = localStorage.getItem("user_id");
let username = localStorage.getItem("username");
if(!userId){ alert("Please login first"); window.location.href="login.html"; }

async function loadHomestay(){
  const res = await fetch(`${API_BASE}/homestays`);
  const data = await res.json();
  const h = data.find(x=>x.id==homestayId);
  if(!h) return alert("Homestay not found.");
  document.getElementById("homestay-name").textContent = h.name;
  document.getElementById("homestay-location").textContent = h.location;
  document.getElementById("homestay-price").textContent = h.price;
  document.getElementById("homestay-description").textContent = h.description;

  const gallery = document.getElementById("image-gallery");
  gallery.innerHTML = h.images.map(i=>`<img src="${i}" style="width:100%; max-height:300px; object-fit:cover; margin-bottom:8px;">`).join('');
}

document.getElementById("booking-form").addEventListener("submit", e=>{
  e.preventDefault();
  const date = document.getElementById("booking-date").value;
  if(!date) return alert("Select a date.");
  localStorage.setItem("booking_info", JSON.stringify({
    homestay_id: homestayId,
    date: date
  }));
  window.location.href=`payment.html?homestay_id=${homestayId}`;
});

loadHomestay();
</script>
</body>
</html>
