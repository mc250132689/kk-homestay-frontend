<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üè° KK Homestay</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
<style>
.card { background: rgba(255,255,255,0.95); color:#000; padding:15px; margin:10px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.2);}
img { max-width:100%; border-radius:12px; }
.flex-container { display:flex; flex-wrap:wrap; justify-content:center;}
.btn { padding:8px 12px; border-radius:8px; cursor:pointer; background:#007BFF; color:#fff; border:none; transition:.3s;}
.btn:hover { background:#0056b3;}
.navbar { display:flex; justify-content:space-between; background:#333; color:#fff; padding:10px;}
.navbar a { color:#fff; text-decoration:none; margin:0 5px;}
</style>
</head>
<body>
<div class="navbar">
  <div>üè° KK Homestay</div>
  <div id="user-panel"></div>
</div>

<div class="flex-container" id="homestay-list"></div>

<script>
const API="https://kk-homestay-backend.onrender.com";
let user=JSON.parse(localStorage.getItem('user'))||null;

function renderUserPanel(){
  const panel=document.getElementById('user-panel');
  if(user){
    panel.innerHTML=`Hello, ${user.username} <button class="btn" onclick="logout()">Logout</button>`;
  } else {
    panel.innerHTML=`<a class="btn" href="login.html">Login</a>`;
  }
}

function logout(){ localStorage.removeItem('user'); user=null; renderUserPanel(); }

async function loadHomestays(){
  const res=await fetch(`${API}/homestays`);
  const data=await res.json();
  const container=document.getElementById('homestay-list');
  container.innerHTML='';
  data.forEach(h=>{
    const img=h.images.length?h.images[0]:'static/images/kinabalu.jpg';
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`
      <h3>${h.name}</h3>
      <img src="${img}" />
      <p>${h.location}</p>
      <p>Price: RM ${h.price}</p>
      <p>${h.description}</p>
      ${user?`<button class="btn" onclick="book(${h.id})">Book Now</button>`:''}
    `;
    container.appendChild(div);
  });
}

async function book(hid){
  const date=prompt("Enter booking date (YYYY-MM-DD):");
  if(!date) return;
  const res=await fetch(`${API}/book`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({homestay_id:hid,user_id:user.user_id,date:date})
  });
  const r=await res.json();
  alert(r.message);
}

renderUserPanel();
loadHomestays();
setInterval(loadHomestays,5000); // auto-refresh every 5s
</script>
</body>
</html>
