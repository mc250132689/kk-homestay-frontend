<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ’³ Payment - KK Homestay</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>Complete Payment</h1>
  <nav><a href="homestays.html">Back to Homestays</a></nav>
</header>

<section>
  <p id="payment-info"></p>
  <button id="pay-button">Simulate Payment</button>
  <p id="status"></p>
</section>

<script>
const API_BASE = "https://kk-homestay-backend.onrender.com";
let userId = localStorage.getItem("user_id");
let username = localStorage.getItem("username");
let bookingInfo = JSON.parse(localStorage.getItem("booking_info"));

if(!userId || !bookingInfo){
  alert("Missing booking info. Please login and select a homestay.");
  window.location.href = "homestays.html";
}

document.getElementById("payment-info").textContent =
  `User: ${username}\nHomestay ID: ${bookingInfo.homestay_id}\nDate: ${bookingInfo.date}\nPrice: RM 100 (placeholder)`;

document.getElementById("pay-button").addEventListener("click", async ()=>{
  // simulate payment
  try{
    const res = await fetch(`${API_BASE}/book`,{
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        homestay_id: parseInt(bookingInfo.homestay_id),
        user_id: parseInt(userId),
        date: bookingInfo.date
      })
    });
    const data = await res.json();
    document.getElementById("status").textContent = "Payment successful! Booking created.";
    localStorage.removeItem("booking_info");
    setTimeout(()=> window.location.href="homestays.html", 1500);
  }catch(err){
    document.getElementById("status").textContent = "Payment failed.";
  }
});
</script>
</body>
</html>
