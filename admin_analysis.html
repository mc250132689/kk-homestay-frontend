<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ“Š Booking Analysis</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>
<h1>Booking Analysis</h1>
<nav><a href="admin.html">Back to Admin Dashboard</a></nav>
</header>

<section>
<h2>Bookings per Homestay</h2>
<canvas id="homestayChart" height="200"></canvas>

<h2>Bookings Over Time</h2>
<canvas id="timeChart" height="200"></canvas>
</section>

<script>
const API_BASE = "https://kk-homestay-backend.onrender.com";

async function fetchStats() {
    const res = await fetch(`${API_BASE}/admin-bookings-stats`);
    return await res.json();
}

async function renderCharts() {
    const data = await fetchStats();

    const homestayCount = {};
    const dateCount = {};
    data.forEach(b => {
        homestayCount[b.homestay] = (homestayCount[b.homestay] || 0) + b.bookings;
        dateCount[b.date] = (dateCount[b.date] || 0) + b.bookings;
    });

    // Homestay Chart
    new Chart(document.getElementById("homestayChart").getContext("2d"),{
        type:'bar',
        data:{
            labels:Object.keys(homestayCount),
            datasets:[{label:'Bookings', data:Object.values(homestayCount), backgroundColor:'#007bff'}]
        },
        options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
    });

    // Time Chart
    const sortedDates = Object.keys(dateCount).sort();
    const sortedCounts = sortedDates.map(d=>dateCount[d]);
    new Chart(document.getElementById("timeChart").getContext("2d"),{
        type:'line',
        data:{
            labels:sortedDates,
            datasets:[{label:'Bookings', data:sortedCounts, borderColor:'#28a745', fill:false, tension:0.2}]
        },
        options:{responsive:true}
    });
}

renderCharts();
</script>
</body>
</html>
