<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üõ†Ô∏è KK Homestay Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>KK Homestay Admin Dashboard</h1>
  <nav><a href="index.html">Home</a></nav>
</header>

<section>
  <form id="admin-form">
    <input type="hidden" id="homestay_id">

    <label>Name</label>
    <input type="text" id="name" required>

    <label>Location</label>
    <input type="text" id="location" required>

    <label>Price (RM)</label>
    <input type="number" id="price" step="0.01" required>

    <label>Description</label>
    <textarea id="description" required></textarea>

    <label>Images (comma-separated URLs)</label>
    <input type="text" id="images">

    <button type="submit">Save Homestay</button>
  </form>

  <div id="homestay-list"></div>
</section>

<script>
const API_BASE = "https://kk-homestay-backend.onrender.com";

async function fetchHomestays() {
  const res = await fetch(`${API_BASE}/homestays`);
  const data = await res.json();
  const list = document.getElementById("homestay-list");
  list.innerHTML = "";
  data.forEach(h => {
    const div = document.createElement("div");
    div.className = "homestay-card";
    div.innerHTML = `
      <h3>${h.name}</h3>
      <p><b>${h.location}</b> ‚Äî RM ${h.price}/night</p>
      <p>${h.description}</p>
      <button onclick="editHomestay(${h.id})">Edit</button>
      <button onclick="deleteHomestay(${h.id})">Delete</button>
    `;
    list.appendChild(div);
  });
}

document.getElementById("admin-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const id = document.getElementById("homestay_id").value;
  const data = new FormData();
  data.append("name", document.getElementById("name").value);
  data.append("location", document.getElementById("location").value);
  data.append("price", document.getElementById("price").value);
  data.append("description", document.getElementById("description").value);
  data.append("images", JSON.stringify(document.getElementById("images").value.split(",").map(s=>s.trim())));

  const url = id ? `${API_BASE}/admin/homestays/${id}` : `${API_BASE}/admin/homestays`;
  const method = id ? "PUT" : "POST";
  const res = await fetch(url, { method, body: data });
  const result = await res.json();
  alert(result.message);
  e.target.reset();
  document.getElementById("homestay_id").value = "";
  fetchHomestays();
});

async function editHomestay(id) {
  const res = await fetch(`${API_BASE}/homestays`);
  const data = await res.json();
  const h = data.find(x => x.id === id);
  if (!h) return;
  document.getElementById("homestay_id").value = h.id;
  document.getElementById("name").value = h.name;
  document.getElementById("location").value = h.location;
  document.getElementById("price").value = h.price;
  document.getElementById("description").value = h.description;
  document.getElementById("images").value = (h.images || []).join(", ");
}

async function deleteHomestay(id) {
  if (!confirm("Delete this homestay?")) return;
  const res = await fetch(`${API_BASE}/admin/homestays/${id}`, { method: "DELETE" });
  const result = await res.json();
  alert(result.message);
  fetchHomestays();
}

fetchHomestays();
</script>
</body>
</html>
