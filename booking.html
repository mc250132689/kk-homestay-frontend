<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Booking - KK Homestay</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID"></script>
</head>
<body>
<section>
<h2>Book Homestay</h2>
<form id="booking-form">
    <label>Date</label>
    <input type="date" id="date" required>
    <button type="submit">Confirm Booking</button>
    <p id="status"></p>
</form>
<div id="paypal-button-container"></div>
</section>

<script>
const API_BASE="https://kk-homestay-backend.onrender.com";
const user_id=localStorage.getItem("user_id");
if(!user_id){alert("Please login first"); window.location.href="login.html";}
const urlParams=new URLSearchParams(window.location.search);
const homestay_id=urlParams.get("homestay_id");

document.getElementById("booking-form").addEventListener("submit", async e=>{
    e.preventDefault();
    const date=document.getElementById("date").value;
    const res=await fetch(`${API_BASE}/book`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({homestay_id,user_id,date})
    });
    const data=await res.json();
    document.getElementById("status").textContent=data.message;

    // Show PayPal button
    paypal.Buttons({
        createOrder: (data, actions)=>actions.order.create({purchase_units:[{amount:{value:"1"}}]}),
        onApprove: async (data, actions)=>{
            await fetch(`${API_BASE}/pay?booking_id=1`); // Simplified; you should fetch booking ID from server
            alert("Payment successful");
        }
    }).render("#paypal-button-container");
});
</script>
</body>
</html>
