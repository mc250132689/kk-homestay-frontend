<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>KK Homestay - Admin</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>üè° Admin Panel</h1>
  <nav><a href="index.html">Home</a></nav>
</header>
<main>
  <h2>Add / Edit Homestay</h2>
  <form id="admin-form">
    <input type="hidden" id="homestay_id">
    <label>Name: <input type="text" id="name" required></label>
    <label>Location: <input type="text" id="location" required></label>
    <label>Price: <input type="number" id="price" required></label>
    <label>Description: <textarea id="description" required></textarea></label>
    <label>Images (comma-separated URLs): <textarea id="images" required></textarea></label>
    <button type="submit">Save</button>
  </form>
  <h2>Existing Homestays</h2>
  <div id="homestay-list"></div>
</main>

<script>
const API_BASE = "https://kk-homestay-backend.onrender.com";

async function fetchHomestays(){
  const res = await fetch(`${API_BASE}/homestays`);
  const data = await res.json();
  const container = document.getElementById("homestay-list");
  container.innerHTML = data.map(h=>{
    let imgs = JSON.parse(h.images || '["https://via.placeholder.com/400x200"]');
    let carousel = `<div class="carousel">${imgs.map((img,i)=>`<img src="${img}" class="carousel-img ${i===0?'active':''}">`).join('')}
    <button class="prev">&#10094;</button><button class="next">&#10095;</button></div>`;
    return `<div class="homestay-card">${carousel}
      <h3>${h.name}</h3>
      <p>${h.description}</p>
      <p>${h.location} - RM${h.price}</p>
      <button onclick="editHomestay(${h.id})">Edit</button>
      <button onclick="deleteHomestay(${h.id})">Delete</button>
    </div>`;
  }).join('');
}

async function saveHomestay(e){
  e.preventDefault();
  const id = document.getElementById('homestay_id').value;
  const data = new FormData();
  data.append('name', document.getElementById('name').value);
  data.append('location', document.getElementById('location').value);
  data.append('price', document.getElementById('price').value);
  data.append('description', document.getElementById('description').value);
  data.append('images', JSON.stringify(document.getElementById('images').value.split(',').map(s=>s.trim())));
  let res;
  if(id) res = await fetch(`${API_BASE}/admin/homestays/${id}`, {method:'PUT', body:data});
  else res = await fetch(`${API_BASE}/admin/homestays`, {method:'POST', body:data});
  const result = await res.json();
  alert(result.message);
  e.target.reset(); document.getElementById('homestay_id').value='';
  fetchHomestays();
}

function editHomestay(id){
  fetch(`${API_BASE}/homestays`).then(r=>r.json()).then(data=>{
    const h=data.find(x=>x.id===id);
    document.getElementById('homestay_id').value=h.id;
    document.getElementById('name').value=h.name;
    document.getElementById('location').value=h.location;
    document.getElementById('price').value=h.price;
    document.getElementById('description').value=h.description;
    document.getElementById('images').value=JSON.parse(h.images).join(', ');
  });
}

async function deleteHomestay(id){
  if(!confirm("Delete this homestay?")) return;
  const res = await fetch(`${API_BASE}/admin/homestays/${id}`, {method:'DELETE'});
  const result = await res.json();
  alert(result.message);
  fetchHomestays();
}

document.getElementById('admin-form').addEventListener('submit', saveHomestay);
fetchHomestays();
</script>
</body>
</html>
