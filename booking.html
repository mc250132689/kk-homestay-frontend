<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>KK Homestay - Booking</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>üè° KK Homestay</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="homestays.html">Browse</a>
  </nav>
</header>
<main>
  <h2>Book Your Stay</h2>
  <div id="homestay-details"></div>
  <form id="booking-form">
    <input type="hidden" id="homestay_id">
    <label>Name: <input type="text" id="name" required></label>
    <label>Email: <input type="email" id="email" required></label>
    <label>Check-in: <input type="date" id="check_in" required></label>
    <label>Check-out: <input type="date" id="check_out" required></label>
    <button type="submit">Confirm Booking</button>
  </form>
  <p id="status"></p>
</main>

<script>
const API_BASE = "https://kk-homestay-backend.onrender.com";
const params = new URLSearchParams(window.location.search);
const id = params.get('id');

async function loadHomestay(){
  const res = await fetch(`${API_BASE}/homestays`);
  const data = await res.json();
  const h = data.find(x=>x.id==id);
  if(!h){ document.getElementById('homestay-details').innerHTML='Homestay not found'; return; }
  document.getElementById('homestay_id').value = h.id;
  const imgs = JSON.parse(h.images || '["https://via.placeholder.com/400x200"]');
  let carousel = `<div class="carousel">${imgs.map((img,i)=>`<img src="${img}" class="carousel-img ${i===0?'active':''}">`).join('')}
  <button class="prev">&#10094;</button><button class="next">&#10095;</button></div>`;
  document.getElementById('homestay-details').innerHTML = `
    <div class="homestay-card">${carousel}
      <h3>${h.name}</h3>
      <p>${h.description}</p>
      <p><b>Location:</b> ${h.location}</p>
      <p><b>Price:</b> RM${h.price}</p>
    </div>`;
}
loadHomestay();

document.getElementById('booking-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = new FormData();
  data.append('homestay_id', document.getElementById('homestay_id').value);
  data.append('name', document.getElementById('name').value);
  data.append('email', document.getElementById('email').value);
  data.append('check_in', document.getElementById('check_in').value);
  data.append('check_out', document.getElementById('check_out').value);
  const res = await fetch(`${API_BASE}/book`, {method:'POST', body:data});
  const result = await res.json();
  document.getElementById('status').textContent = result.message;
});
</script>
</body>
</html>
